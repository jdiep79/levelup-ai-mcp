## ğŸ” Auth0 API Configuration for Secure MCP Integration

This walkthrough covers how to **secure your ToDos API** using **Auth0** for authentication and authorization, enabling robust protection of your endpoints with **JWTs**, **OAuth 2.0**, and **OpenID Connect** protocols.

---

### âš™ï¸ What Weâ€™re Configuring

- **Auth0 Tenant** ğŸŒ â€“ Your unique tenant under Auth0
- **API Registration** ğŸ“² â€“ Define your API in Auth0 so it can issue JWTs
- **Permissions (Scopes)** ğŸ§¾ â€“ Define granular access levels like `read:todos`
- **Offline Access** ğŸ”„ â€“ Enable refresh tokens for long-lived sessions
- **Environment Variables** ğŸ” â€“ Configure your local app to trust tokens from Auth0

---

### ğŸ§± Step-by-Step Breakdown

#### 1. **Find Your Tenant Name**

ğŸ” Go to the top left of the Auth0 dashboard â†’ **Tenant Identifier** (e.g. `your-tenant.us.auth0.com`).

---

#### 2. **Create the ToDos API**

Navigate to **Applications â†’ APIs**:

- **Name**: `todos API`
- **Identifier**: `https://todos.api` (used as `audience` in JWT claims)
- Click **Create**

---

#### 3. **Enable Refresh Tokens**

Go to your API â†’ **Settings** â†’ Enable âœ… **Allow Offline Access**

ğŸ” This allows issuing **refresh tokens** to clients (MCP agents) for long sessions.

---

#### 4. **Define Scopes (Permissions)**

Go to the **Permissions** tab:

- Add `read:todos` â†’ _Read the todo list_
- Add `read:billing` â†’ _Read the billing information_

ğŸ“Œ These define what an app can do with the access token.

---

#### 5. **Review Node.js Example**

Under **Quickstart â†’ Node.js**, see example JWT validation.

- Your app will use:

  - `AUTH0_DOMAIN` = `https://your-tenant.us.auth0.com`
  - `AUTH0_AUDIENCE` = `https://todos.api`

âœ… These are critical for JWT signature verification and audience validation.

---

### ğŸ“„ Configure `.dev.vars` File

Create a file named `.dev.vars`:

```env
AUTH0_DOMAIN=https://your-tenant.us.auth0.com
AUTH0_AUDIENCE=https://todos.api
```

ğŸŒ± Used locally to feed env vars to your dev server.

---

### ğŸš€ Run and Test Locally

```bash
npm run dev
```

Visit:

```
http://localhost:8789
```

**Expected Result**:

> `401 Unauthorized` â€“ Perfect! Your app is now enforcing token-based authentication.

---

### ğŸ§ª Test with Auth0 Playground

Auth0 lets you simulate a login:

1. Go to your API â†’ **Test** tab
2. Generate **access token** via curl
3. Replace `access_token` in this sample:

```bash
curl -H "Authorization: Bearer <access_token>" http://localhost:8789/api/me
```

âœ… You should receive your JWT payload with claims like:

- `sub` (user ID)
- `aud` (audience)
- `iat`, `exp` (issued/expiry time)

ğŸš« If you try `/api/todos` without the `read:todos` scope, youâ€™ll get `403 Forbidden` â€” the middleware is working!

---

### ğŸ§  Key Concepts

| Concept             | Description                                                                     |
| ------------------- | ------------------------------------------------------------------------------- |
| `AUTH0_DOMAIN` ğŸŒ   | Auth0's base URL used for fetching public keys for token verification           |
| `AUTH0_AUDIENCE` ğŸ¯ | Specifies the API the token is intended for; must match the token's `aud` claim |
| JWT Middleware ğŸ§¾   | Validates the tokenâ€™s issuer, signature, audience, and (optionally) scopes      |
| Scopes vs Tokens ğŸ›¡ï¸ | Token = identity; Scope = permissions/authorization                             |
| Refresh Tokens ğŸ”   | Keeps user sessions active without re-authentication                            |

---

### âœ… Summary

- ğŸ—ï¸ Youâ€™ve registered a secured API in Auth0
- ğŸ›¡ï¸ Configured scopes and enforced them via middleware
- ğŸ” Set up a local `.dev.vars` to secure your dev server
- ğŸ§ª Successfully tested real JWT-authenticated requests

Your ToDos API is now **OAuth2.0 compliant** and ready to **interact securely with MCP agents** and **remote frontends** like Cloud Desktop or Cursor ğŸ§ ğŸ’»ğŸŒ

Let me know if youâ€™d like a visual flow diagram of the OAuth process with MCP integration!
